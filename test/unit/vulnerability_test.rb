require 'helper'

module Gemsurance
  class VulnerabilityTest < Test::Unit::TestCase
    def test_attributes
      v = Vulnerability.new(vulnerability_yaml)

      expected = YAML.load(vulnerability_yaml)
      assert_equal expected, v.attributes
      Vulnerability::ATTRIBUTES.each do |attr|
        assert_equal expected[attr.to_s], v.send(attr)
      end
    end

    def test_equality
      v_1 = Vulnerability.new(vulnerability_yaml)
      v_2 = Vulnerability.new(vulnerability_yaml)

      assert_equal v_1, v_2
    end

  private

    def vulnerability_yaml
<<-YAML
---
gem: actionpack
framework: rails
cve: 2013-0156
osvdb: 89026
url: http://osvdb.org/show/osvdb/89026
title: |
  Ruby on Rails params_parser.rb Action Pack Type Casting Parameter Parsing
  Remote Code Execution

description: |
  Ruby on Rails contains a flaw in params_parser.rb of the Action Pack.
  The issue is triggered when a type casting error occurs during the parsing
  of parameters. This may allow a remote attacker to potentially execute
  arbitrary code.
date: 2013-04-01

cvss_v2: 10.0

patched_versions:
  - ~> 2.3.15
  - ~> 3.0.19
  - ~> 3.1.10
  - ">= 3.2.11"
YAML
    end

  end
end
